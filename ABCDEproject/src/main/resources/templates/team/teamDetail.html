<!DOCTYPE html>
<html xmlns:th="thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>TEAM</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Rajdhani:wght@300&family=Roboto:wght@100&family=Rubik+Lines&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Gowun+Batang&family=Rubik+Lines&display=swap" rel="stylesheet">

<style>
	th, td{
		font-family: Gowun Batang, 'Gowun Batang';
		line-height: 50px;
		height: 50px;
	}
	
	#btn, #btn2 {
		font-family: Gowun Batang, 'Gowun Batang';
	}
</style>
<script th:src="@{https://code.jquery.com/jquery-3.6.4.min.js}"></script>
<script th:src="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/js/jquery-3.6.0.js}"></script>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

<script>
	
	$(document).ready(function () {
		
		function fetchResults() {
			// 선택된 옵션의 값과 입력된 검색어 값을 가져옴
			var searchWord = $('input[name="searchWord"]').val();

			console.log(searchWord);

			$.ajax({
				url: 'searchMember',
				type: 'post',
				data: { searchWord: searchWord },
				success: function (list) {
					let str = '<tr>';

					$(list).each(function (idx, member) {
						str += '<tr>';
						str += '<td style="width:110px; text-align:center;">' + member.memberid + '</td>';
						str += '<td style="width:110px; text-align:center;">' + member.email + '</td>';
						str += '<td style="width:110px; text-align:center;">' + member.phone + '</td>' + '<td style="width:100px; text-align:center;">' + '<input type="button" class="inviteBtn btn btn-success" name="' + member.id + ' ' + teamId + '" value="초대">' + '</td>';
						str += '</tr>';

					});
				str += '</tr>';
				$('#modalTable').html(str);
				$('.inviteBtn').on('click', invMem);
               },
               error: function (error) {
                  console.error('Error:', error);
               }
            });
		}
		
		$('input[name="searchWord"]').keyup(function () {
            fetchResults();
		});
	}); // document
	
	function invMem() {
	    let name = $(this).attr('name');
	    let [num, teamId] = name.split(' ');
	    console.log(num, teamId);
	    
	    $.ajax({
	        url: 'inviteMember',
	        type: 'post',
	        context: this,
	        data: { 'num': num, 'teamId': teamId },
	        success: function () {
				$(this).removeClass("btn-info").addClass("btn-light").val('수락 대기');
				//$(this).val('수락 대기');
	        },
	        error: function (e) {
	            alert(JSON.stringify(e));
	        }
	    });
	}
	
	function addMember(button) {
		let addWord = document.querySelector('#addWord').value;
		let teamId = button.getAttribute('data-teamid');
		
		$.ajax({
	    	type: 'post',
	        url: 'addMember',
	        data: { 'addWord' : addWord},
	        success: function(list) {
	            let str = '<table>';
				
				$(list).each(function(idx, member){
					str += '<tr>';
					str += '<td style="width:110px; text-align:center;">' + member.memberid + '</td>';
					str += '<td style="width:110px; text-align:center;">' + member.email + '</td>';
					str += '<td style="width:110px; text-align:center;">' + member.phone + '</td>' + '<td style="width:100px; text-align:center;">' + '<input type="button" class="inviteBtn btn btn-success" name="'+member.id+' '+teamId+'" value="초대">' + '</td>';
					str += '</tr>';
					
				});
				str += '</table>';
				$('#modalTable').html(str);
				$('.inviteBtn').on('click', invMem);
	        },
	        error: function(error) {
	            console.error('Error:', error);
	        }
	    });
	    
		$("#modal").modal("show");
	}
	

	function deleteMember(button) {
		let id = button.getAttribute('data-id');
		let teamId = button.getAttribute('data-teamid');
		
		if (confirm('해당 팀원을 퇴출하시겠습니까?')) {
			location.href = 'deleteMember?id=' + id + '&teamId=' + teamId;
		}
	}
	
	
   
</script>
</head>
<body>
	
	<div>
		<nav style="position: fixed; top: 0; width: 100%; z-index: 100; padding-top: 30px; padding-bottom: 30px; background-color: black;">
			<ul style="list-style: none; padding: 0; margin: 0; display: flex; flex-direction: row; justify-content: space-around;">
				<li style="margin: 0 10px;"><a style="text-decoration: none; color: white; font-family: 'Rajdhani', sans-serif;" th:href="@{/}" th:text="|FOOTBALLPLANET|"></a></li>
				
				<li style="margin: 0 10px;">
				<li style="margin: 0 10px;"><a style="text-decoration: none; color: white; font-family: 'Rajdhani', sans-serif;" th:href="@{/stadium/stadiumList}" th:text="stadium"></a></li>
				<li style="margin: 0 10px;" th:if="${#authorization.expression('hasRole(''ROLE_USER'')')}"><a style="text-decoration: none; color: white; font-family: 'Rajdhani', sans-serif;" th:href="@{/matching/requestMatching}" th:text="matching"></a></li>
				<li style="margin: 0 10px;" th:if="${#authorization.expression('hasRole(''ROLE_ADMIN'')')}"><a style="text-decoration: none; color: white; font-family: 'Rajdhani', sans-serif;" th:href="@{/record/recordList}" th:text="schedule"></a></li>
				<li style="margin: 0 10px;"><a style="text-decoration: none; color: white; font-family: 'Rajdhani', sans-serif;" th:href="@{/team/teamList}" th:text="team"></a></li>
				<li style="margin: 0 10px;" th:if="${#authorization.expression('hasRole(''ROLE_USER'')')}"><a style="text-decoration: none; color: white; font-family: 'Rajdhani', sans-serif;" th:href="@{/recruitment/recruitmentList}" th:text="recruitment"></a></li>
				</li>
				
				<li style="margin: 0 10px;"><a style="text-decoration: none; color: white; font-family: 'Rajdhani', sans-serif;" th:href="@{/myPage/myPage}" th:text="|MY PAGE|"></a></li>
			</ul>
		</nav>
	</div>
	
	<div style="margin: 100px auto 0 auto; width: 70vw;">
		<table class="table">
			<tr>
				<td>팀 이름</td>
				<td th:text="${team.team_name}"></td>
				<td>팀장</td>
				<td th:text="${team.leader_id}"></td>
				<td>
					<button></button>
					<button></button>
				</td>
			</tr>
			<tr>
				<td>팀 설명</td>
				<td th:text="${team.team_description}" colspan="3"></td>
			</tr>
		</table>
		
		<table>
			<tr>
				<td style="width: 50vw;">
					<form id="search" method="get" th:action="@{/team/detail}">
						<div class="input-group mb-3">
						  <input type="text" name="searchWord" th:value="${searchWord}" class="form-control" aria-describedby="button-addon2" autocomplete="off" th:data-teamid="${teamId}" id="searchMember">
						  <button class="btn btn-outline-secondary" type="submit" id="button-addon2">팀원 검색</button>
						</div>
					</form>
				</td>
				<td style="width: 50vw;">
					<form>
						<div class="input-group mb-3">
						  <input type="text" id="addWord" name="addWord" class="form-control" aria-describedby="button-addon2" autocomplete="off">
						  <button class="btn btn-outline-secondary" type="button" id="button-addon2" th:data-teamid="${teamId}" onclick="addMember(this);">팀원 추가</button>
						</div>
					</form>
				</td>
			</tr>
		</table>
		
		<table class="table">
			<tr>
				<th>프로필</th>
				<th style="width: 30vw;">아이디</th>
				<th>포인트</th>
				<th>전화번호</th>
				<th></th>
			</tr>
			<tr th:each="tm : ${teamMember}">
				<div id="search">
					<th><img th:src="@{'/img/' + ${tm.thumbnail}}" style="max-width: 50px; max-height: 50px;"></th>
					<th th:text="${tm.memberid}"></th>
					<th th:text="${tm.point}"></th>
					<th th:text="${tm.phone}"></th>
					<th>
						<form>
							<input type="hidden" th:id="${tm.id}" th:teamid="${teamId}">
							<input type="button" th:data-id="${tm.id}" th:data-teamid="${teamId}" value="퇴출" class="btn btn-danger" onclick="deleteMember(this);">
						</form>
					</th>
				</div>
			</tr>
		</table>
	</div>
	
	<!--모달-->
	<div class="modal fade" tabindex="-1" role="dialog" id="modal">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title">팀원 추가</h5>
	      </div>
	      <div class="modal-body">
	        <!-- 모달 내용 -->
	      	<div id="modalTable"></div>
	      </div>
	    </div>
	  </div>
	</div>
	
	
</body>
</html>





